CREATE DATABASE QL_TOURDULICH
GO
USE QL_TOURDULICH
GO 
USE MASTER
GO
DROP DATABASE QL_TOURDULICH
GO
CREATE TABLE PHANQUYEN 
(
NHOM NVARCHAR(30) NOT NULL PRIMARY KEY,
PHANQUYEN VARCHAR(30)
)
GO
CREATE TABLE TAIKHOAN
(
TENDN VARCHAR(20) NOT NULL PRIMARY KEY,
MATKHAU VARCHAR(50), 
NHOM NVARCHAR(30)
)
GO
CREATE TABLE NHANVIEN
(
MANV INT IDENTITY(1,1) PRIMARY KEY,
TENNV NVARCHAR(50),
LUONGCB INT, 
HINHANH VARCHAR(100)
)
GO 
CREATE TABLE CHITIETNV
(
MANV INT NOT NULL PRIMARY KEY,
GIOITINH NVARCHAR(10),
NGAYSINH DATE,
SDT VARCHAR(20),
CMND VARCHAR(20)
)
CREATE TABLE KHACHHANG
(
MAKH INT IDENTITY(1, 1) PRIMARY KEY,
TENKH NVARCHAR(50),
SDT VARCHAR(20),
CMND VARCHAR(20),
DIACHI NVARCHAR(50)
)
GO
CREATE TABLE XE
(
BIENSOXE VARCHAR(20) PRIMARY KEY, 
MANV INT,
TINHTRANG INT, 
MALOAIXE INT
)
GO
CREATE TABLE GHE
(
MAGHE VARCHAR(10) NOT NULL PRIMARY KEY,
TINHTRANG INT,
BIENSOXE VARCHAR(20)
)
GO
CREATE TABLE LOAIXE
(
MALOAIXE INT IDENTITY(1,1) PRIMARY KEY,
TENLOAI NVARCHAR(20),
SOGHE INT,
CHIPHI INT
) 
GO
CREATE TABLE LOAITOUR
(
MALOAITOUR INT IDENTITY(1,1) PRIMARY KEY,
TENLOAITOUR NVARCHAR(50)
)
GO
CREATE TABLE HINHANH
(
MAHINH INT IDENTITY(1,1) PRIMARY KEY,
TENHINH VARCHAR(50)
) 
GO
CREATE TABLE TOUR
(
MATOUR VARCHAR(20) NOT NULL PRIMARY KEY,
MALOAITOUR INT,
TENTOUR NVARCHAR(50),
MAHINH INT,
CHIPHI INT
)
GO 
CREATE TABLE CTTOUR
(
MATOUR VARCHAR(20) PRIMARY KEY,
BIENSOXE VARCHAR(10),
NGAYBD DATE,
NGAYKT DATE
)
GO 
CREATE TABLE HOADON
(
MAHD INT IDENTITY(1,1) PRIMARY KEY,
MAKH INT,
MANV INT,
NGAYLAP DATE,
TONGTIEN INT
)
GO
CREATE TABLE CTHD 
(
MAHD INT,
MATOUR VARCHAR(20),
MAGHE VARCHAR(10),
SLNGUOI INT,
PRIMARY KEY (MAHD, MATOUR, MAGHE)
)
---------------------------------------------------------------------------------
GO 
ALTER TABLE TAIKHOAN ADD CONSTRAINT FK_PHANQUYEN_TAIKHOAN FOREIGN KEY (NHOM) REFERENCES PHANQUYEN(NHOM)
GO
ALTER TABLE CHITIETNV ADD CONSTRAINT FK_TAIKHOAN_CTNHANVIEN FOREIGN KEY (SDT) REFERENCES TAIKHOAN(TENDN)
GO
ALTER TABLE GHE ADD CONSTRAINT FK_GHE_XE FOREIGN KEY (BIENSOXE) REFERENCES XE(BIENSOXE)
GO
ALTER TABLE XE ADD CONSTRAINT FK_XE_LOAIXE FOREIGN KEY (MALOAIXE) REFERENCES LOAIXE(MALOAIXE)
GO
ALTER TABLE CHITIETNV ADD CONSTRAINT FK_NV_CHITIETNV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)
GO
ALTER TABLE CTTOUR ADD CONSTRAINT FK_CTTUOR_TOUR FOREIGN KEY (MATOUR) REFERENCES TOUR(MATOUR)
GO
ALTER TABLE TOUR ADD CONSTRAINT FK_TOUR_LOAITOUR FOREIGN KEY (MALOAITOUR) REFERENCES LOAITOUR(MALOAITOUR)
ALTER TABLE TOUR ADD CONSTRAINT FK_TOUR_HINHANH FOREIGN KEY (MAHINH) REFERENCES HINHANH(MAHINH)
GO
ALTER TABLE HOADON ADD CONSTRAINT FK_HD_NHANVIEN FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)
ALTER TABLE HOADON ADD CONSTRAINT FK_HD_KHACHHANG FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH)
GO
ALTER TABLE CTHD ADD CONSTRAINT FK_CTHD_HOADON FOREIGN KEY (MAHD) REFERENCES HOADON(MAHD)
ALTER TABLE CTHD ADD CONSTRAINT FK_CTHD_GHE FOREIGN KEY (MAGHE) REFERENCES GHE(MAGHE)
ALTER TABLE CTHD ADD CONSTRAINT FK_CTHD_TOUR FOREIGN KEY (MATOUR) REFERENCES TOUR(MATOUR)
------------------------------------------------------------------------------------------
GO
INSERT INTO PHANQUYEN VALUES (N'Quản lý', 'ALL')
INSERT INTO PHANQUYEN VALUES (N'Hướng dẫn viên', 'SELECT')
INSERT INTO PHANQUYEN VALUES (N'Nhân viên', 'SELECT, CREATE, UPDATE')
SELECT * FROM PHANQUYEN

GO 
INSERT INTO TAIKHOAN VALUES ('01234', '0000', N'Quản lý')
INSERT INTO TAIKHOAN VALUES ('012345', '0000', N'Hướng dẫn viên')
INSERT INTO TAIKHOAN VALUES ('0123456', '0000',N'Nhân viên')
INSERT INTO TAIKHOAN VALUES ('0123478', '0000', N'Nhân viên')
SELECT * FROM TAIKHOAN

GO
INSERT INTO NHANVIEN(TENNV, LUONGCB) VALUES (N'Lê Lương Diệu Linh', 3000000)
INSERT INTO NHANVIEN(TENNV, LUONGCB) VALUES (N'Đỗ Duy Phương', 3000000)
INSERT INTO NHANVIEN(TENNV, LUONGCB) VALUES (N'Huỳnh Kiến Phúc', 3000000)
INSERT INTO NHANVIEN(TENNV, LUONGCB) VALUES (N'Đõ Duy Mạnh', 3000000)
SELECT * FROM NHANVIEN

GO
INSERT INTO CHITIETNV VALUES (1, N'Nữ', '1-12-2000', '01234', '26122567')
INSERT INTO CHITIETNV VALUES (2, N'Nam', '12-12-2000', '012345', '26122567')
INSERT INTO CHITIETNV VALUES (3, N'Nam', '4-10-2000', '0123456', '26122567')
INSERT INTO CHITIETNV VALUES (4, N'Nam', '6-8-2000', '0123478', '26122567')
SELECT * FROM CHITIETNV

GO
INSERT INTO KHACHHANG VALUES (N'Nguyễn Thị Kim Trang', '0909123', '261345999', N'Tân Phú')
INSERT INTO KHACHHANG VALUES (N'Trần Thị Kinh Ngân', '09091234', '261345437', N'Tân Bình')
INSERT INTO KHACHHANG VALUES (N'Đỗ Duy Khánh', '090912345', '261345728', N'Bình Tân')
INSERT INTO KHACHHANG VALUES (N'Vương Thị Mỹ Hạnh', '0909123456', '261345653', N'Bình Thạnh')
SELECT * FROM KHACHHANG

GO
INSERT INTO LOAIXE VALUES (N'Ghế ngồi', 40, 150)
INSERT INTO LOAIXE VALUES (N'Giường nằm', 20, 200)
/*INSERT INTO LOAIXE VALUES (N'VIP', 20, 500)*/
SELECT * FROM LOAIXE

GO
INSERT INTO XE VALUES ('HP-23 2765', 4, 0, 1)
INSERT INTO XE VALUES ('BT-22 1299', 4, 0, 2)
SELECT * FROM XE

GO 
INSERT INTO GHE VALUES ('L101', 0, 'HP-23 2765')
INSERT INTO GHE VALUES ('L102', 0, 'HP-23 2765')
INSERT INTO GHE VALUES ('L103', 0, 'HP-23 2765')
INSERT INTO GHE VALUES ('L104', 0, 'HP-23 2765')
INSERT INTO GHE VALUES ('L105', 0, 'HP-23 2765')
INSERT INTO GHE VALUES ('L106', 0, 'HP-23 2765')
INSERT INTO GHE VALUES ('L107', 0, 'HP-23 2765')
INSERT INTO GHE VALUES ('L108', 0, 'HP-23 2765')
INSERT INTO GHE VALUES ('L109', 0, 'HP-23 2765')
INSERT INTO GHE VALUES ('L110', 0, 'HP-23 2765')
INSERT INTO GHE VALUES ('L111', 0, 'HP-23 2765')
INSERT INTO GHE VALUES ('R101', 0, 'BT-22 1299')
INSERT INTO GHE VALUES ('R102', 0, 'BT-22 1299')
INSERT INTO GHE VALUES ('R103', 0, 'BT-22 1299')
INSERT INTO GHE VALUES ('R104', 0, 'BT-22 1299')
INSERT INTO GHE VALUES ('R105', 0, 'BT-22 1299')
INSERT INTO GHE VALUES ('R106', 0, 'BT-22 1299')
INSERT INTO GHE VALUES ('R107', 0, 'BT-22 1299')
INSERT INTO GHE VALUES ('R108', 0, 'BT-22 1299')
INSERT INTO GHE VALUES ('R109', 0, 'BT-22 1299')
INSERT INTO GHE VALUES ('R110', 0, 'BT-22 1299')
INSERT INTO GHE VALUES ('R111', 0, 'BT-22 1299')
SELECT * FROM GHE

GO
INSERT INTO LOAITOUR VALUES ( N'Miền Nam')
INSERT INTO LOAITOUR VALUES ( N'Miền Trung')
INSERT INTO LOAITOUR VALUES ( N'Miền Bắc')
SELECT * FROM LOAITOUR

GO 
INSERT INTO HINHANH(TENHINH) VALUES ('hinh1.png')
INSERT INTO HINHANH(TENHINH) VALUES ('hinh2.png')
INSERT INTO HINHANH(TENHINH) VALUES ('hinh3.png')
SELECT * FROM HINHANH

GO
INSERT INTO TOUR VALUES ('PQ0120', 1, N'Du lịch Phú Quốc', 1, 12000000)
INSERT INTO TOUR VALUES ('PQ0121', 1, N'Du lịch Phú Quý', 1, 10000000)
INSERT INTO TOUR VALUES ('CH0220', 2, N'Du lịch Chùa Cổ Thạch', 2, 8000000)
INSERT INTO TOUR VALUES ('SP0320', 3, N'Du lịch SaPa', 3, 15000000)
SELECT *FROM TOUR

GO
INSERT INTO CTTOUR VALUES ('PQ0120','HP-23 2765', '2-2-2022', '5-2-2022')
INSERT INTO CTTOUR VALUES ('PQ0121','HN-46 7725', '5-2-2022', '12-2-2022')
INSERT INTO CTTOUR VALUES ('CH0220','HN-46 7725', '1-2-2022', '3-2-2022')
INSERT INTO CTTOUR VALUES ('SP0320','HP-23 2765', '1-3-2022', '3-3-2022')
SELECT * FROM CTTOUR

SET DATEFORMAT DMY
INSERT INTO HOADON (MAKH,MANV,NGAYLAP,TONGTIEN) 
VALUES('4','1','23-5-2022',0)
GO 
INSERT INTO HOADON (NGAYLAP) VALUES ('1-2-2022')
INSERT INTO HOADON (NGAYLAP) VALUES ('3-2-2022')
INSERT INTO HOADON (NGAYLAP) VALUES ('1-28-2022')
INSERT INTO HOADON (NGAYLAP) VALUES ('2-28-2022')

SELECT * FROM HOADON

GO 
INSERT INTO CTHD VALUES (1,'PQ0120', 'L101', 1)
INSERT INTO CTHD VALUES (2,'PQ0121', 'L102', 1)
INSERT INTO CTHD VALUES (3,'CH0220', 'R101', 1)
INSERT INTO CTHD VALUES (4,'SP0320', 'R102', 1)
SELECT * FROM CTHD

GO
UPDATE GHE SET TINHTRANG = 1 WHERE MAGHE = 'L101'
UPDATE GHE SET TINHTRANG = 1 WHERE MAGHE = 'L102'
UPDATE GHE SET TINHTRANG = 1 WHERE MAGHE = 'R101'
UPDATE GHE SET TINHTRANG = 1 WHERE MAGHE = 'R102'
SELECT * FROM GHE
---------------------

SELECT * FROM CTTOUR
SELECT * FROM TOUR

UPDATE TOUR SET MAHINH = NULL WHERE MATOUR != 'M001'

select * from LOAITOUR where TENLOAITOUR = N'Miền Nam'

delete from TOUR where MATOUR = 'CH0220'
delete from TOUR where MATOUR = 'CH0220'

SELECT * FROM GHE WHERE BIENSOXE = 'HP-23 2765'