create database QL_CHVLXD

go
USE QL_CHVLXD

CREATE TABLE KHACHHANG
(
	MAKH CHAR(10) NOT NULL,
	TEN NVARCHAR(30),
	DCHI NVARCHAR(20),
	DTHOAI CHAR(10) UNIQUE,
	MALOAI CHAR(10),
	CONSTRAINT PK_MAKH PRIMARY KEY (MAKH)
)

CREATE TABLE LOAIKHACH
(
	MALOAI CHAR(10) NOT NULL,
	TENLOAI NVARCHAR(50),
	CONSTRAINT PK_MALOAIKHACH PRIMARY KEY (MALOAI)
)

CREATE TABLE NHACUNGCAP
(
	MANCC CHAR(10) NOT NULL,
	TENNCC NVARCHAR(50),
	DCHI NVARCHAR(50),
	DTHOAI CHAR(10) UNIQUE,
	CONSTRAINT PK_MANCC PRIMARY KEY (MANCC)
)

CREATE TABLE LOAIHANG
(
	MALOAI CHAR(10) NOT NULL,
	TENLOAI NVARCHAR(50),
	CONSTRAINT PK_MALOAI PRIMARY KEY (MALOAI)
)

CREATE TABLE DONVITINH
(
	MADV CHAR(10)NOT NULL,
	DVTINH NVARCHAR(20),
	CONSTRAINT PK_MADV PRIMARY KEY (MADV)
)

CREATE TABLE CHUCVU
(
	MACV CHAR(10) NOT NULL,
	PHANCONG NVARCHAR(50)
	CONSTRAINT PK_MACV PRIMARY KEY (MACV)
)

CREATE TABLE HANGHOA
(
	MAHH CHAR(10) NOT NULL,
	MALOAI CHAR(10),
	TENHH NVARCHAR(50),
	MADV CHAR(10),
	XUATXU NVARCHAR(50),
	CONSTRAINT PK_MAHH PRIMARY KEY (MAHH)
)

CREATE TABLE NHANVIEN
(
	MANV CHAR(10) NOT NULL,
	TENNV NVARCHAR(50),
	MACV CHAR(10),
	GIOITINH NVARCHAR(10),
	NGAYSINH DATETIME,
	DCHI NVARCHAR(50),
	DTHOAI CHAR(10) UNIQUE,
	TAIKHOAN CHAR(15),
	MATKHAU CHAR(15),
	CONSTRAINT PK_MANV PRIMARY KEY (MANV)
)


CREATE TABLE HD_NHAP
(
	MA_HD_NHAP CHAR(10) NOT NULL,
	MANCC CHAR(10),
	MANV CHAR(10),
	NGAYLAP_NHAP DATETIME DEFAULT GETDATE(),
	TONGTIEN FLOAT,	
	CONSTRAINT PK_HD_NHAP PRIMARY KEY (MA_HD_NHAP)
)

CREATE TABLE CHITIET_HD_NHAP
(
	MA_HD_NHAP CHAR(10) NOT NULL,
	MAHH CHAR(10) NOT NULL,
	SOLUONG_NHAP FLOAT,
	DVTINH NVARCHAR(50),
	DONGIA_NHAP FLOAT CHECK (DONGIA_NHAP > 0),
	THANHTIEN FLOAT,
	CONSTRAINT PK_MA_CTHD_NHAP PRIMARY KEY (MA_HD_NHAP, MAHH)
)

CREATE TABLE HD_XUAT
(
	MA_HD_XUAT CHAR(10) NOT NULL,
	MAKH CHAR(10),
	MANV CHAR(10),
	NGAYLAP_XUAT DATETIME DEFAULT GETDATE(),
	TONGTIEN FLOAT,
	CONSTRAINT PK_MA_HD_XUATT PRIMARY KEY (MA_HD_XUAT)
)

CREATE TABLE CHITIET_HD_XUAT
(
	MA_HD_XUAT CHAR(10) NOT NULL,
	MAHH CHAR(10) NOT NULL,
	SOLUONG_XUAT FLOAT,
	DVTINH NVARCHAR(50),
	DONGIA_XUAT FLOAT CHECK (DONGIA_XUAT > 0),
	THANHTIEN FLOAT,
	CONSTRAINT PK_MA_CTHD_XUAT PRIMARY KEY (MA_HD_XUAT, MAHH)
)


ALTER TABLE HANGHOA
ADD CONSTRAINT FK_HH_MALOAI FOREIGN KEY (MALOAI) REFERENCES LOAIHANG(MALOAI)
ALTER TABLE HD_NHAP
ADD CONSTRAINT FK_HDNHAP_MANCC FOREIGN KEY (MANCC) REFERENCES NHACUNGCAP(MANCC)
ALTER TABLE HD_NHAP
ADD CONSTRAINT FK_HDNHAP_MANV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)
ALTER TABLE CHITIET_HD_NHAP
ADD CONSTRAINT FK_CTHD_NHAP_MAHH FOREIGN KEY (MAHH) REFERENCES HANGHOA(MAHH)
ALTER TABLE CHITIET_HD_NHAP
ADD CONSTRAINT FK_CTHD_NHAP_SOHD_NHAP FOREIGN KEY (MA_HD_NHAP) REFERENCES HD_NHAP(MA_HD_NHAP)
ALTER TABLE HD_XUAT
ADD CONSTRAINT FK_HD_XUAT_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH)
ALTER TABLE HD_XUAT
ADD CONSTRAINT FK_HD_XUAT_MANV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)
ALTER TABLE CHITIET_HD_XUAT
ADD CONSTRAINT FK_CTHD_XUAT_MAHH FOREIGN KEY (MAHH) REFERENCES HANGHOA(MAHH)
ALTER TABLE CHITIET_HD_XUAT
ADD CONSTRAINT FK_CTHD_XUAT_SOHD_XUAT FOREIGN KEY (MA_HD_XUAT) REFERENCES HD_XUAT(MA_HD_XUAT)
ALTER TABLE KHACHHANG
ADD CONSTRAINT FK_KH_MALOAI FOREIGN KEY (MALOAI) REFERENCES LOAIKHACH(MALOAI)
ALTER TABLE HANGHOA
ADD CONSTRAINT FK_HH_MADV FOREIGN KEY (MADV) REFERENCES DONVITINH(MADV)
ALTER TABLE NHANVIEN
ADD CONSTRAINT FK_NV_MACV FOREIGN KEY (MACV) REFERENCES CHUCVU(MACV)

--Loại khách
INSERT INTO LOAIKHACH VALUES('LK01',N'Vựa')
INSERT INTO LOAIKHACH VALUES('LK02',N'Công trình lớn')
INSERT INTO LOAIKHACH VALUES('LK03',N'Công trình nhỏ')

select * from KHACHHANG 
--Khách Hàng
INSERT INTO KHACHHANG VALUES('KH1',N'Trần Quốc Chiến',N'Quận 1','0945637843','LK01')
INSERT INTO KHACHHANG VALUES('KH2',N'Trần Văn Cường',N'Tân Bình','0948767843','LK02')
INSERT INTO KHACHHANG VALUES('KH3',N'Phan Quốc Hùng',N'Bình Chánh','0946782433','LK03')
INSERT INTO KHACHHANG VALUES('KH4',N'Nguyễn Thị Nở',N'Quận 2','0945637865','LK02')
INSERT INTO KHACHHANG VALUES('KH5',N'Hồ Huyền Trân',N'Quận 10','075637843','LK03')
INSERT INTO KHACHHANG VALUES('KH6',N'Đặng Thu Hiền',N'Bình Tân','0145637843','LK01')
INSERT INTO KHACHHANG VALUES('KH7',N'Trần Tuấn Kiệt',N'Quận 3','0345637843','LK01')
INSERT INTO KHACHHANG VALUES('KH8',N'Trần Quốc Khánh',N'Hóc môn','0947037843','LK01')
INSERT INTO KHACHHANG VALUES('KH9',N'Nguyễn Anh Phi',N'Quận 5','0949157843','LK03')
INSERT INTO KHACHHANG VALUES('KH10',N'Trần Phú Quý',N'Quận 7','0945647634','LK03')
INSERT INTO KHACHHANG VALUES('KH11',N'Phan Trung Kiên',N'Quận 1','0945730843','LK02')
INSERT INTO KHACHHANG VALUES('KH12',N'Huỳnh Quốc Tuấn',N'Tân Bình','0932386543','LK02')

--Nhà Cung Cấp
select * from NHACUNGCAP

INSERT INTO NHACUNGCAP VALUES('NCC1',N'Vicen',N'Q1,TP.Hồ Chí Minh','0983645532')
INSERT INTO NHACUNGCAP VALUES('NCC2',N'Bỉm Sơn',N'Bình Chánh,TP.Hồ Chí Minh','0356645732')
INSERT INTO NHACUNGCAP VALUES('NCC3',N'FiCo',N'Tân Bình,TP.Hồ Chí Minh','0989274532')
INSERT INTO NHACUNGCAP VALUES('NCC4',N'Đồng Tâm 17',N'Q5,TP.Hồ Chí Minh','0969320482')
INSERT INTO NHACUNGCAP VALUES('NCC5',N'Thép VISA',N'Bến Lức,Long An','0272364776')
INSERT INTO NHACUNGCAP VALUES('NCC6',N'Thép Hòa Phát',N'Bình Chánh,TP.Hồ Chí Minh','093806173')
INSERT INTO NHACUNGCAP VALUES('NCC7',N'Tôn Đông Á',N'Kiều An, Hải Phòng','0313548828')
INSERT INTO NHACUNGCAP VALUES('NCC8',N'Tôn Phương Nam ',N'Nhơn Trạch, Đồng Nai','0213568379')
--Loại Hàng
INSERT INTO LOAIHANG VALUES('LH1',N'Gạch')
INSERT INTO LOAIHANG VALUES('LH2',N'Cát')
INSERT INTO LOAIHANG VALUES('LH3',N'Đá')
INSERT INTO LOAIHANG VALUES('LH4',N'Xi măng')
INSERT INTO LOAIHANG VALUES('LH5',N'Tôn')
INSERT INTO LOAIHANG VALUES('LH6',N'Thép')
--DON VI
INSERT INTO DONVITINH VALUES('DV01',N'Viên')
INSERT INTO DONVITINH VALUES('DV02',N'Khối')
INSERT INTO DONVITINH VALUES('DV03',N'M3')
INSERT INTO DONVITINH VALUES('DV04',N'M2')
INSERT INTO DONVITINH VALUES('DV05',N'Bao')
INSERT INTO DONVITINH VALUES('DV06',N'Kg')
--Hàng Hóa

select * from HANGHOA
INSERT INTO HANGHOA VALUES('HH1','LH1',N'Gạch đinh 2 lỗ','DV01',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH2','LH1',N'Gạch ống 3 lỗ','DV01',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH3','LH1',N'Gạch ống 6 lỗ','DV01',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH4','LH1',N'Gạch 4 lỗ','DV01',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH5','LH2',N'Cát vàng xây dựng','DV02',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH6','LH2',N'Cát bê tông','DV02',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH7','LH2',N'Cát xây tô','DV02',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH8','LH2',N'Cát san lấp','DV02',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH9','LH3',N'Đá 4*6','DV03',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH10','LH3',N'Đá 5*7','DV03',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH11','LH3',N'Đá mi sang-mi bụi',N'DV03',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH12','LH3',N'Đá 2*4','DV03',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH13','LH3',N'Đá 1*2','DV03',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH14','LH3',N'Đá 0*4','DV03',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH15','LH4',N'Xi Măng Vicem Hà Tiên','DV05',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH16','LH4',N'Xi Măng Bỉm Sơn','DV05',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH17','LH4',N'Xi Măng Fico','DV05',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH18','LH5',N'Tôn Mạ Màu','DV04',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH19','LH5',N'Tôn Vân Gỗ','DV04',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH20','LH5',N'Tôn Kẽm','DV04',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH21','LH5',N'Tôn Kẽm Màu','DV04',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH22','LH6',N'Thép Lá','DV06',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH23','LH6',N'Thép Cây','DV06',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH24','LH6',N'Thép Ống','DV06',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH25','LH6',N'Thép Cuộn PONIMA','DV06',N'Việt Nam')
INSERT INTO HANGHOA VALUES('HH26','LH6',N'Thép Vằn PONIMA','DV06',N'Việt Nam')

--Chức vụ
INSERT INTO CHUCVU VALUES('CV01',N'Quản Lý')
INSERT INTO CHUCVU VALUES('CV02',N'Nhân Viên Bán Hàng')
INSERT INTO CHUCVU VALUES('CV03',N'Nhân Viên Kho')
select * from NHANVIEN
--	Nhân Viên
SET DATEFORMAT DMY
INSERT INTO NHANVIEN VALUES('NV1',N'Nguyễn Chí Hiếu','CV01',N'Nam','12/03/1990',N'Đồng Nai','0164738241','quanly','123')
INSERT INTO NHANVIEN VALUES('NV2',N'Phan Văn Đạt','CV01',N'Nam','10/12/1995',N'Củ Chi','0164465761','quanly2','123')
INSERT INTO NHANVIEN VALUES('NV3',N'Trần Trung Trực','CV02',N'Nam','17/05/1989',N'Quận 12','0908768241','nhanvien1','123')
INSERT INTO NHANVIEN VALUES('NV4',N'Phan Văn Bình','CV03',N'Nam','23/04/1998',N'Bình Tân','0164734341','nhanvien2','123')
INSERT INTO NHANVIEN VALUES('NV5',N'Trần Quang Đại','CV03',N'Nam','14/08/1991',N'Thủ Đức','0113738241','nhanvien3','123')
INSERT INTO NHANVIEN VALUES('NV6',N'Nguyễn Thế Tùng','CV02',N'Nam','02/10/1993',N'Quận 2','0164000241','nhanvien4','123')
INSERT INTO NHANVIEN VALUES('NV7',N'Huỳnh Đức Long','CV03',N'Nam','11/02/1991',N'Quận 10','0164460241','nhanvien5','123')
INSERT INTO NHANVIEN VALUES('NV8',N'Hoàng Việt Cường','CV02',N'Nam','07/08/1995',N'Gò Vấp','0786738241','nhanvien6','123')
INSERT INTO NHANVIEN VALUES('NV9',N'Nguyễn Thị Lan','CV02',N'Nữ','27/04/1985',N'Bình Tân','0386738241','nhanvien7','123')

--Hóa đơn nhập
SET DATEFORMAT DMY
INSERT INTO HD_NHAP VALUES('HDN1','NCC2','NV4','01/01/2021',null)
INSERT INTO HD_NHAP VALUES('HDN2','NCC8','NV5','15/02/2021',null)
INSERT INTO HD_NHAP VALUES('HDN3','NCC3','NV7','28/02/2021',null)
INSERT INTO HD_NHAP VALUES('HDN4','NCC6','NV7','15/03/2021',null)
INSERT INTO HD_NHAP VALUES('HDN5','NCC5','NV4','01/12/2021',null)
INSERT INTO HD_NHAP VALUES('HDN6','NCC1','NV7','11/10/2021',null)

select * from HD_NHAP
select * from CHITIET_HD_NHAP
UPDATE HD_NHAP
SET TONGTIEN = (SELECT SUM(THANHTIEN) FROM CHITIET_HD_NHAP WHERE CHITIET_HD_NHAP.MA_HD_NHAP = HD_NHAP.MA_HD_NHAP)

--Chi tiết hóa đơn nhập
INSERT INTO CHITIET_HD_NHAP VALUES('HDN1','HH1',1000,N'Viên',1000,null)
INSERT INTO CHITIET_HD_NHAP VALUES('HDN1','HH7',1,N'Khối',200000,null)
INSERT INTO CHITIET_HD_NHAP VALUES('HDN2','HH8',2,N'Khối',220000,null)
INSERT INTO CHITIET_HD_NHAP VALUES('HDN2','HH2',2000,N'Viên',1100,null)
INSERT INTO CHITIET_HD_NHAP VALUES('HDN3','HH3',6000,N'Viên',1200,null)
INSERT INTO CHITIET_HD_NHAP VALUES('HDN3','HH10',5,'M3',295000,null)
INSERT INTO CHITIET_HD_NHAP VALUES('HDN4','HH4',16700,N'Viên',1500,null)
INSERT INTO CHITIET_HD_NHAP VALUES('HDN5','HH5',1,N'Khối',380000,null)
INSERT INTO CHITIET_HD_NHAP VALUES('HDN6','HH6',2,N'Khối',460000,null)

select * from CHITIET_HD_NHAP
UPDATE CHITIET_HD_NHAP
SET THANHTIEN = SOLUONG_NHAP * DONGIA_NHAP
--Hóa đơnn xuất///
SET DATEFORMAT DMY
INSERT INTO HD_XUAT VALUES('HDX1','KH2','NV3','01/01/2021',null)
INSERT INTO HD_XUAT VALUES('HDX2','KH8','NV6','15/02/2021',null)
INSERT INTO HD_XUAT VALUES('HDX3','KH3','NV8','28/02/2021',null)
INSERT INTO HD_XUAT VALUES('HDX4','KH6','NV9','15/03/2021',null)
INSERT INTO HD_XUAT VALUES('HDX5','KH5','NV3','01/12/2021',null)
INSERT INTO HD_XUAT VALUES('HDX6','KH1','NV9','11/10/2021',null)

select * from HD_XUAT
select * from CHITIET_HD_XUAT
UPDATE HD_XUAT
SET TONGTIEN = (SELECT SUM(THANHTIEN) FROM CHITIET_HD_XUAT WHERE CHITIET_HD_XUAT.MA_HD_XUAT = HD_XUAT.MA_HD_XUAT)
--Chi tiết hóa đơn xuất///
INSERT INTO CHITIET_HD_XUAT VALUES('HDX1','HH1',1000,N'Viên',2000,null)
INSERT INTO CHITIET_HD_XUAT VALUES('HDX1','HH4',3,N'Khối',500000,null)
INSERT INTO CHITIET_HD_XUAT VALUES('HDX2','HH2',4000,N'Viên',2200,null)
INSERT INTO CHITIET_HD_XUAT VALUES('HDX2','HH5',2,N'Khối',450000,null)
INSERT INTO CHITIET_HD_XUAT VALUES('HDX3','HH3',2000,N'Viên',1500,null)
INSERT INTO CHITIET_HD_XUAT VALUES('HDX3','HH4',1,N'Khối',500000,null)
INSERT INTO CHITIET_HD_XUAT VALUES('HDX4','HH6',3000,N'Viên',1900,null)
INSERT INTO CHITIET_HD_XUAT VALUES('HDX5','HH5',1,N'Khối',400000,null)
INSERT INTO CHITIET_HD_XUAT VALUES('HDX6','HH4',2,N'Khối',500000,null)

select * from CHITIET_HD_XUAT
UPDATE CHITIET_HD_XUAT
SET THANHTIEN = SOLUONG_XUAT * DONGIA_XUAT

CREATE VIEW HOADON_NHAP AS
SELECT HD_NHAP.MA_HD_NHAP, MANCC, MANV, NGAYLAP_NHAP, MAHH, SOLUONG_NHAP, DONGIA_NHAP, DVTINH, THANHTIEN
FROM HD_NHAP, CHITIET_HD_NHAP
WHERE HD_NHAP.MA_HD_NHAP = CHITIET_HD_NHAP.MA_HD_NHAP

SELECT * FROM HOADON_NHAP

CREATE VIEW HOADON_XUAT AS
SELECT HD_XUAT.MA_HD_XUAT, MAKH, MANV, NGAYLAP_XUAT, MAHH, SOLUONG_XUAT, DONGIA_XUAT, DVTINH, THANHTIEN
FROM HD_XUAT, CHITIET_HD_XUAT
WHERE HD_XUAT.MA_HD_XUAT = CHITIET_HD_XUAT.MA_HD_XUAT

SELECT * FROM HOADON_NHAP
select * from HD_NHAP
select * from CHITIET_HD_NHAP
select distinct MA_HD_NHAP from CHITIET_HD_NHAP